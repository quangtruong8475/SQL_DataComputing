CREATE DATABASE QuanLyMayTinh
GO
USE QuanLyMayTinh
GO
CREATE TABLE NHASANXUAT
( 
	MANSX VARCHAR(5) PRIMARY KEY,
	TENNSX NVARCHAR(50) Not null,
	QUOCGIA NVARCHAR(100) Null
)
GO
CREATE TABLE NHACUNGCAP
(
	MANCC VARCHAR(5) PRIMARY KEY,
	TENNCC NVARCHAR(50) Not null,
	DIACHI NVARCHAR(50) Not null,
	SDT VARCHAR(15) Not null
)

GO
CREATE TABLE LOAITHIETBI
(
	MALOAI VARCHAR(5) PRIMARY KEY,
	TENLOAI NVARCHAR(50) NOT NULL,
	DONVITINH VARCHAR(50) NOT NULL,
	GHICHU VARCHAR(50)  NULL
)
GO
CREATE TABLE NHANVIEN
(	
	MANV VARCHAR(5) PRIMARY KEY,
	TENNV NVARCHAR(50) NOT NULL,
	NGAYSINH DATE NOT NULL,
	SDT VARCHAR(15) NULL
)
	
GO
CREATE TABLE KHACHHANG
(
	MAKH VARCHAR(5) PRIMARY KEY,
	TENKH NVARCHAR(50) NOT NULL,
	DIACHI NVARCHAR(50) NOT NULL,
	SDT VARCHAR(15) NOT NULL
)
GO
CREATE TABLE THIETBI
(
	MATHIETBI VARCHAR(5) PRIMARY KEY,
	TENTHIETBI NVARCHAR(100) Not null,
	THONGSOKT VARCHAR(50) Not null,
	GIATHANH FLOAT,
	MANSX VARCHAR(5) ,
	MANCC VARCHAR(5),
	MALOAI VARCHAR(5),
	FOREIGN KEY(MANSX) REFERENCES NHASANXUAT(MANSX),
	FOREIGN KEY(MANCC) REFERENCES NHACUNGCAP(MANCC),
	FOREIGN KEY(MAlOAI) REFERENCES LOAITHIETBI(MALOAI)
)
GO
CREATE TABLE PHIEUNHAP
(	
	MAPN VARCHAR(5) PRIMARY KEY,
	MANV VARCHAR(5),
	MANCC VARCHAR(5) ,
	NGAYNHAP DATE NOT NULL
	FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
	FOREIGN KEY (MANCC) REFERENCES  NHACUNGCAP(MANCC)
)
GO
CREATE TABLE PHIEUXUAT
(
	MAPX VARCHAR(5) PRIMARY KEY,
	MANV VARCHAR(5),
	MAKH VARCHAR(5) ,
	NGAYXUAT DATE NOT NULL
	FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV),
	FOREIGN KEY (MAKH) REFERENCES  KHACHHANG(MAKH)
)
GO
CREATE TABLE CTPN
( 
	MAPN VARCHAR(5) ,
	MATHIETBI VARCHAR(5) ,
	SOLUONG INT NOT NULL,
	DONGIA FLOAT NOT NULL,
	PRIMARY KEY(MAPN,MATHIETBI)	
)
		
GO
CREATE TABLE CTPX
(
    MAPX VARCHAR(5) ,
	MATHIETBI VARCHAR(5) ,
	SOLUONG INT NOT NULL,
	DONGIA FLOAT NOT NULL,
	PRIMARY KEY(MAPX,MATHIETBI)
)

	
GO
--1.Tạo ngày xuất tự động lấy ngày hiện tại
ALTER TABLE PHIEUXUAT ADD CONSTRAINT ngay_xuat DEFAULT GETDATE() FOR NGAYXUAT;
GO
--2.Tạo ràng buộc ngày sinh của nhân viên phải < ngày hiện tại
ALTER TABLE NHANVIEN ADD CONSTRAINT check_ngay_sinh check( NGAYSINH<GETDATE());
GO
--3.Các loại thiết bị
ALTER TABLE LOAITHIETBI add constraint loai_thietbi check( TENLOAI in('bàn phím', 'tai nghe', 'pin','chip','chuot'));
GO
--4.Thêm ràng buộc UNIQUE cho cột SDT bảng NHANVIEN
ALTER TABLE NHANVIEN ADD CONSTRAINT uq_sdt UNIQUE (SDT)
GO
--5.tạo ngày nhập tự động lấy ngày hiện tại
 ALTER TABLE PHIEUNHAP ADD CONSTRAINT  ngay_nhap default getdate() for NGAYNHAP
 GO
INSERT INTO NHASANXUAT(MANSX,TENNSX,QUOCGIA) VALUES
('NSX01','SamSung','Korea'),
('NSX02','Tesla','Mỹ'),
('NSX03','Toyota','Japan'),
('NSX04','Xaomi','China'),
('NSX05','Iphone','Mỹ')
GO
INSERT INTO NHACUNGCAP(MANCC,TENNCC,DIACHI,SDT) VALUES
('NCC01','Nguyễn Thị Thư','Đà Nẵng','0364758756'),
('NCC02','Nguyễn Thị Nga','Hà Nôi','0384758156'),
('NCC03','Nguyễn Đình Nam','Hải Phòng','0324728956'),
('NCC04','Nguyễn Văn Nghĩa','Nghệ An','0464758956'),
('NCC05','Nguyễn Đình Tuấn','Hồ Chí Minh','0365753956')
GO
INSERT INTO LOAITHIETBI(MALOAI,TENLOAI,DONVITINH,GHICHU) VALUES
('L0001','bàn phím','kilogam',  null),
('L0002','tai nghe','gam', null),
('L0003','pin','gam', null),
('L0004','chip','gam', null),
('L0005','chuot','kilogam', null)
GO
INSERT INTO NHANVIEN(MANV,TENNV,NGAYSINH,SDT) VALUES
('NV001','Nguyễn Đình Kha','2003-3-3','129387456'),
('NV002','Nguyễn Văn Hiếu','2002-4-5','832043382'),
('NV003','Nguyễn Lê Hiếu','2001-9-2','938374674'),
('NV004','Nguyễn Văn Bình','2002-7-6','988362145'),
('NV005','Lê Đức An','2002-1-5','093388421')
GO
INSERT INTO  KHACHHANG(MAKH,TENKH,DIACHI,SDT) VALUES
('KH001','Lê Thị Na','Bình Thuận','837119913'),
('KH002','Lê Hồng Nữ','Đồng Tháp','123859435'),
('KH003','Phan Sĩ Sơn','An Giang','049284932'),
('KH004','Lê Thị Thủy','Quảng Bình','029383213'),
('KH005','Nguyễn Thảo Ly','Hà Tĩnh','948382105')
GO
INSERT INTO PHIEUNHAP(MAPN,MANV,MANCC,NGAYNHAP) VALUES
('PN001','NV001','NCC01','2023-4-5'),
('PN002','NV002','NCC02','2023-4-6'),
('PN003','NV003','NCC03','2023-4-7'),
('PN004','NV004','NCC04','2023-4-16'),
('PN005','NV005','NCC05','2023-4-20')
GO
INSERT INTO PHIEUXUAT(MAPX,MANV,MAKH,NGAYXUAT) VALUES
('PX001','NV001','KH001','2023-5-4'),
('PX002','NV002','KH002','2023-5-7'),
('PX003','NV003','KH003','2023-5-8'),
('PX004','NV004','KH004','2023-5-13'),
('PX005','NV005','KH005','2023-5-21')
GO
INSERT INTO CTPN(MAPN,MATHIETBI,SOLUONG,DONGIA) VALUES
('PN001','MTB01','25',24.000),
('PN002','MTB02','50',22.000),
('PN003','MTB03','80',27.000),
('PN004','MTB04','20',29.000),
('PN005','MTB05','30',32.000)
GO
INSERT INTO CTPX(MAPX,MATHIETBI,SOLUONG,DONGIA) VALUES
('PX001','MTB01','12',24.000),
('PX002','MTB03','7',27.000),
('PX003','MTB02','4',22.000),
('PX004','MTB05','14',32.000),
('PX005','MTB04','16',29.000)
GO
INSERT INTO THIETBI(MATHIETBI,MALOAI,MANSX,MANCC,GIATHANH,THONGSOKT,TENTHIETBI) VALUES
('MTB01','L0001','NSX01','NCC01',24.000,'10MPA','LENOVO'),
('MTB02','L0002','NSX02','NCC02',22.000,'20DPA','GAMMING'),
('MTB03','L0003','NSX03','NCC03',27.000,'15TPA','DELL'),
('MTB04','L0004','NSX04','NCC04',29.000,'29CPA','ASUZ'),
('MTB05','L0005','NSX05','NCC05',32.000,'34RPA','MACBOOK')
GO
--1.Hiển thị thông tin nhà cung cấp có số lượng thiết bị lớn hơn 25.
SELECT C.MANCC,C.TENNCC,C.DIACHI,C.SDT
FROM CTPN A
INNER JOIN PHIEUNHAP B ON A.MAPN=B.MAPN
INNER JOIN NHACUNGCAP C ON C.MANCC=B.MANCC
WHERE A.SOLUONG>25;
GO
--2.Liệt kê danh sách các phiếu xuất được lập trong khoảng thời gian từ ngày 06/05/2023 đến ngày 21/05/2023.
SELECT *
FROM PHIEUXUAT
WHERE NGAYXUAT BETWEEN '2023-05-6' AND '2023-05-21';
GO
--3.Tìm kiếm thông tin khách hàng có số điện thoại là "123859435".
SELECT *
FROM KHACHHANG 
WHERE  SDT='123859435';
GO
--4.Liệt kê danh sách các phiếu xuất được lập trong tháng 5/2023 và có chứa ít nhất một thiết bị của loại "L0004", 
--hiển thị thông tin của cả phiếu xuất và chi tiết phiếu xuất.
SELECT *  
FROM PHIEUXUAT px
INNER JOIN CTPX A ON PX.MAPX=A.MAPX
INNER JOIN THIETBI B ON A.MATHIETBI=B.MATHIETBI
WHERE MONTH(PX.NGAYXUAT)=5 AND B.MALOAI='L0004'
GO
--5.Liệt kê danh sách các thiết bị được nhập vào trong tháng 4/2023, bao gồm thông tin mã thiết bị, tên thiết bị, số lượng và đơn giá.
SELECT A.MATHIETBI,B.TENTHIETBI,SUM(SOLUONG) AS 'TONG SO LUONG',DONGIA
FROM CTPN A
INNER JOIN PHIEUNHAP PN ON PN.MAPN=A.MAPN
INNER JOIN THIETBI B ON B.MATHIETBI=A.MATHIETBI
WHERE MONTH(PN.NGAYNHAP) =4 AND YEAR(PN.NGAYNHAP)=2023
GROUP BY A.MATHIETBI,B.TENTHIETBI,DONGIA